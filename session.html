<!DOCTYPE html>
<html>
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Karting Session Viewer</title>
Â  <style>
Â  Â  * { margin: 0; padding: 0; box-sizing: border-box; }
Â  Â  
Â  Â  body {
Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
Â  Â  Â  color: #e0e0e0;
Â  Â  Â  min-height: 100vh;
Â  Â  Â  padding: 20px;
Â  Â  }

Â  Â  .container {
Â  Â  Â  max-width: 1400px;
Â  Â  Â  margin: 0 auto;
Â  Â  }

Â  Â  .header {
Â  Â  Â  background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
Â  Â  Â  padding: 30px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  box-shadow: 0 8px 32px rgba(211, 47, 47, 0.3);
Â  Â  }

Â  Â  .driver-name {
Â  Â  Â  font-size: 2.5em;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
Â  Â  }

Â  Â  .stats-grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  Â  Â  gap: 20px;
Â  Â  Â  margin-bottom: 30px;
Â  Â  }

Â  Â  .stat-card {
Â  Â  Â  background: #2d2d2d;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  border-left: 4px solid #f44336;
Â  Â  Â  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
Â  Â  }

Â  Â  .stat-label {
Â  Â  Â  color: #999;
Â  Â  Â  font-size: 0.9em;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  margin-bottom: 8px;
Â  Â  }

Â  Â  .stat-value {
Â  Â  Â  font-size: 1.8em;
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #fff;
Â  Â  }

Â  Â  .stat-value.small {
Â  Â  Â  font-size: 1.4em;
Â  Â  }

Â  Â  .fastest-time {
Â  Â  Â  color: #ffd700;
Â  Â  Â  font-size: 2.2em;
Â  Â  }

Â  Â  .consistency-excellent { color: #4caf50; }
Â  Â  .consistency-good { color: #8bc34a; }
Â  Â  .consistency-fair { color: #ffc107; }
Â  Â  .consistency-poor { color: #ff9800; }

Â  Â  .chart-container {
Â  Â  Â  background: #2d2d2d;
Â  Â  Â  padding: 30px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  margin-bottom: 30px;
Â  Â  Â  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
Â  Â  Â  position: relative;
Â  Â  }

Â  Â  .chart-title {
Â  Â  Â  font-size: 1.5em;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  color: #fff;
Â  Â  }

Â  Â  .line-chart {
Â  Â  Â  position: relative;
Â  Â  Â  height: 300px;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  .chart-canvas {
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  cursor: pointer;
Â  Â  }

Â  Â  .home-button {
Â  Â  Â  display: inline-block;
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  background: rgba(255, 255, 255, 0.2);
Â  Â  Â  color: white;
Â  Â  Â  text-decoration: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  transition: all 0.3s;
Â  Â  Â  border: 2px solid rgba(255, 255, 255, 0.3);
Â  Â  }

Â  Â  .home-button:hover {
Â  Â  Â  background: rgba(255, 255, 255, 0.3);
Â  Â  Â  border-color: rgba(255, 255, 255, 0.5);
Â  Â  Â  transform: translateY(-2px);
Â  Â  }

Â  Â  .header-content {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 20px;
Â  Â  }

Â  Â  .header-info {
Â  Â  Â  flex: 1;
Â  Â  }

Â  Â  .socials {
Â  Â  Â  background: #2d2d2d;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
Â  Â  }

Â  Â  .socials a {
Â  Â  Â  display: inline-block;
Â  Â  Â  margin: 0 15px;
Â  Â  Â  color: #f44336;
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-weight: 600;
Â  Â  Â  transition: all 0.3s;
Â  Â  }

Â  Â  .socials a:hover {
Â  Â  Â  color: #ff5252;
Â  Â  Â  transform: translateY(-2px);
Â  Â  }

Â  Â  .track-link {
Â  Â  Â  color: #f44336;
Â  Â  Â  text-decoration: none;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  .track-link:hover {
Â  Â  Â  color: #ff5252;
Â  Â  }

Â  Â  .comparison-container {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  padding: 20px;
Â  Â  Â  background: #2d2d2d;
Â  Â  Â  border-radius: 12px;
Â  Â  }

Â  Â  .comparison-input {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 10px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }

Â  Â  .comparison-input input {
Â  Â  Â  flex: 1;
Â  Â  Â  padding: 10px;
Â  Â  Â  background: #1e1e1e;
Â  Â  Â  border: 2px solid #3d3d3d;
Â  Â  Â  color: #e0e0e0;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 1em;
Â  Â  }

Â  Â  .comparison-input button {
Â  Â  Â  padding: 10px 20px;
Â  Â  Â  background: #f44336;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: bold;
Â  Â  Â  transition: all 0.3s;
Â  Â  }

Â  Â  .comparison-input button:hover {
Â  Â  Â  background: #d32f2f;
Â  Â  }

Â  Â  .comparison-grid {
Â  Â  Â  display: grid;
Â  Â  Â  /* Allow up to 4 columns for comparison cards */
Â  Â  Â  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
Â  Â  Â  gap: 20px;
Â  Â  }

Â  Â  .comparison-card {
Â  Â  Â  background: #1e1e1e;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  border-top: 4px solid #f44336; /* Default color for main session */
Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
Â  Â  }

Â  Â  .comparison-card h3 {
Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  color: #fff;
Â  Â  Â  font-size: 1.2em;
Â  Â  }

Â  Â  .comparison-card p {
Â  Â  Â  margin: 5px 0;
Â  Â  Â  font-size: 0.9em;
Â  Â  }

Â  Â  .legend {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 20px;
Â  Â  Â  margin-top: 20px;
Â  Â  Â  justify-content: center;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }

Â  Â  .legend-item {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 8px;
Â  Â  }

Â  Â  .legend-color {
Â  Â  Â  width: 20px;
Â  Â  Â  height: 20px;
Â  Â  Â  border-radius: 4px;
Â  Â  }

Â  Â  .error-message {
Â  Â  Â  color: #f44336;
Â  Â  Â  padding: 10px;
Â  Â  Â  background: rgba(244, 67, 54, 0.1);
Â  Â  Â  border-radius: 8px;
Â  Â  Â  margin-top: 10px;
Â  Â  }

Â  Â  .tooltip {
Â  Â  Â  position: absolute;
Â  Â  Â  background: rgba(30, 30, 30, 0.95);
Â  Â  Â  border: 2px solid #f44336;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  color: #e0e0e0;
Â  Â  Â  font-size: 14px;
Â  Â  Â  pointer-events: none;
Â  Â  Â  z-index: 1000;
Â  Â  Â  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
Â  Â  Â  max-width: 250px;
Â  Â  Â  transition: opacity 0.2s ease;
Â  Â  Â  opacity: 0;
Â  Â  }

Â  Â  .tooltip-header {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-bottom: 6px;
Â  Â  Â  border-bottom: 1px solid #444;
Â  Â  Â  padding-bottom: 4px;
Â  Â  }

Â  Â  .tooltip-driver {
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #4caf50; /* Color for comparison driver in tooltip */
Â  Â  }

Â  Â  .tooltip-lap {
Â  Â  Â  color: #f44336;
Â  Â  Â  font-weight: bold;
Â  Â  }

Â  Â  .tooltip-time {
Â  Â  Â  font-size: 18px;
Â  Â  Â  font-weight: bold;
Â  Â  Â  margin: 8px 0;
Â  Â  Â  color: #fff;
Â  Â  }

Â  Â  .tooltip-best {
Â  Â  Â  color: #ffd700;
Â  Â  Â  font-weight: bold;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 4px;
Â  Â  }

Â  Â  .tooltip-delta {
Â  Â  Â  font-size: 12px;
Â  Â  Â  color: #999;
Â  Â  }

Â  Â  .tooltip-footer {
Â  Â  Â  margin-top: 6px;
Â  Â  Â  padding-top: 6px;
Â  Â  Â  border-top: 1px solid #444;
Â  Â  Â  font-size: 12px;
Â  Â  Â  color: #aaa;
Â  Â  }

Â  Â  .tooltip-visible {
Â  Â  Â  opacity: 1;
Â  Â  }

Â  Â  .tooltip-arrow {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 0;
Â  Â  Â  height: 0;
Â  Â  Â  border-left: 8px solid transparent;
Â  Â  Â  border-right: 8px solid transparent;
Â  Â  Â  border-top: 8px solid #f44336;
Â  Â  Â  bottom: -8px;
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  }

Â  Â  .point-hover {
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="container">
Â  Â  <div class="header">
Â  Â  Â  <div class="header-content">
Â  Â  Â  Â  <div class="header-info">
Â  Â  Â  Â  Â  <div class="driver-name" id="driver"></div>
Â  Â  Â  Â  Â  <div id="session-date"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <a href="index.html" class="home-button">ğŸ  Home</a>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="stats-grid">
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-label">Fastest Lap</div>
Â  Â  Â  Â  <div class="stat-value fastest-time" id="fastest"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-label">Average Lap</div>
Â  Â  Â  Â  <div class="stat-value small" id="average"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-label">Consistency</div>
Â  Â  Â  Â  <div class="stat-value small" id="consistency"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-label">Track</div>
Â  Â  Â  Â  <div class="stat-value" style="font-size: 1.3em;">
Â  Â  Â  Â  Â  <a class="track-link" id="track-link" target="_blank"></a>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-label">Kart</div>
Â  Â  Â  Â  <div class="stat-value" id="kart"></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-label">Total Laps</div>
Â  Â  Â  Â  <div class="stat-value" id="total-laps"></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="chart-container">
Â  Â  Â  <div class="chart-title">ğŸ“ˆ Lap Time Progression</div>
Â  Â  Â  <div class="line-chart">
Â  Â  Â  Â  <canvas id="lap-chart" class="chart-canvas"></canvas>
Â  Â  Â  </div>
Â  Â  Â  <div id="chart-legend" class="legend"></div>
Â  Â  </div>

Â  Â  <div class="comparison-container">
Â  Â  Â  <div class="chart-title">ğŸ”„ Compare Sessions</div>
Â  Â  Â  <div class="comparison-input">
Â  Â  Â  Â  <input type="text" id="compare-id" placeholder="Enter session ID(s) to compare, separated by commas (e.g., uuid1, uuid2)">
Â  Â  Â  Â  <button onclick="compareSession()">Compare</button>
Â  Â  Â  Â  <button onclick="clearComparison()" style="background: #666;">Clear</button>
Â  Â  Â  </div>
Â  Â  Â  <div id="comparison-results" class="comparison-grid"></div>
Â  Â  </div>

Â  Â  <div class="socials">
Â  Â  Â  <strong>Follow:</strong>
Â  Â  Â  <a id="ig" target="_blank">Instagram</a>
Â  Â  Â  <a id="fb" target="_blank">Facebook</a>
Â  Â  Â  <a id="web" target="_blank">Website</a>
Â  Â  </div>
Â  </div>

Â  <div id="chart-tooltip" class="tooltip"></div>

Â  <script>
Â  Â  let currentSessionData = null;
Â  Â  // Holds ALL comparison session data objects (driver, laps, etc.)
Â  Â  let comparisonSessions = []; 
Â  Â  let chartPoints = [];
Â  Â  // Current session's valid lap data (parsed)
Â  Â  let currentDataset = []; 
Â  Â  // Array of valid lap data arrays for comparison sessions
Â  Â  let comparisonDatasets = []; 
Â  Â  let activePoint = null;
Â  Â  const params = new URLSearchParams(window.location.search);
Â  Â  const sessionId = params.get("id") || "example-session";

Â  Â  // Color palette for multiple comparisons
Â  Â  const comparisonColors = [
Â  Â  Â  { line: '#4caf50', point: '#8bc34a' }, // Green
Â  Â  Â  { line: '#2196f3', point: '#64b5f6' }, // Blue
Â  Â  Â  { line: '#ff9800', point: '#ffb74d' }, // Orange
Â  Â  Â  { line: '#9c27b0', point: '#ba68c8' }, // Purple
Â  Â  Â  { line: '#00bcd4', point: '#4dd0e1' }, // Cyan
Â  Â  Â  { line: '#ffeb3b', point: '#fff176' }, // Yellow
Â  Â  Â  { line: '#795548', point: '#a1887f' }, // Brown
Â  Â  Â  { line: '#e91e63', point: '#f06292' }  // Pink
Â  Â  ];

Â  Â  fetch(`sessions/${sessionId}.json`)
Â  Â  Â  .then(r => {
        if (!r.ok) throw new Error('Main session not found');
        return r.json();
      })
Â  Â  Â  .then(data => {
Â  Â  Â  Â  currentSessionData = data;
Â  Â  Â  Â  renderSession(data);
Â  Â  Â  })
Â  Â  Â  .catch(err => {
Â  Â  Â  Â  document.body.innerHTML = '<div style="text-align:center; padding: 50px; color: #f44336;"><h1>âŒ Session not found</h1></div>';
Â  Â  Â  });

Â  Â  function parseTime(timeStr) {
Â  Â  Â  const parts = timeStr.split(':');
Â  Â  Â  if (parts.length === 2) {
Â  Â  Â  Â  const minutes = parseInt(parts[0]);
Â  Â  Â  Â  const seconds = parseFloat(parts[1]);
Â  Â  Â  Â  return minutes * 60 + seconds;
Â  Â  Â  }
Â  Â  Â  return parseFloat(timeStr);
Â  Â  }

Â  Â  function formatTime(seconds) {
Â  Â  Â  const mins = Math.floor(seconds / 60);
Â  Â  Â  // Ensure seconds are formatted with 3 decimal places
Â  Â  Â  const secs = (seconds % 60).toFixed(3); 
Â  Â  Â  return mins > 0 ? `${mins}:${secs.padStart(6, '0')}` : `${secs}s`;
Â  Â  }

Â  Â  function calculateConsistency(lapTimes) {
Â  Â  Â  const avg = lapTimes.reduce((a, b) => a + b, 0) / lapTimes.length;
Â  Â  Â  const variance = lapTimes.reduce((sum, time) => sum + Math.pow(time - avg, 2), 0) / lapTimes.length;
Â  Â  Â  const stdDev = Math.sqrt(variance);
Â  Â  Â  return stdDev;
Â  Â  }

Â  Â  function getConsistencyRating(stdDev) {
Â  Â  Â  if (stdDev < 0.3) return { text: 'Excellent', class: 'consistency-excellent' };
Â  Â  Â  if (stdDev < 0.6) return { text: 'Good', class: 'consistency-good' };
Â  Â  Â  if (stdDev < 1.0) return { text: 'Fair', class: 'consistency-fair' };
Â  Â  Â  return { text: 'Variable', class: 'consistency-poor' };
Â  Â  }

Â  Â  function setupTooltipInteractions() {
Â  Â  Â  const canvas = document.getElementById('lap-chart');
Â  Â  Â  const tooltip = document.getElementById('chart-tooltip');
Â  Â  Â  
Â  Â  Â  // Clear previous handlers to prevent memory leaks/duplicate listeners
Â  Â  Â  canvas.removeEventListener('mousemove', canvas.currentMouseMoveHandler);
Â  Â  Â  canvas.removeEventListener('mouseleave', canvas.currentMouseLeaveHandler);

Â  Â  Â  canvas.currentMouseMoveHandler = (e) => {
Â  Â  Â  Â  const rect = canvas.getBoundingClientRect();
Â  Â  Â  Â  const x = e.clientX - rect.left;
Â  Â  Â  Â  const y = e.clientY - rect.top;
Â  Â  Â  Â  
Â  Â  Â  Â  let closestPoint = null;
Â  Â  Â  Â  let minDistance = Infinity;
Â  Â  Â  Â  
Â  Â  Â  Â  chartPoints.forEach(point => {
Â  Â  Â  Â  Â  const distance = Math.sqrt(Math.pow(x - point.x, 2) + Math.pow(y - point.y, 2));
Â  Â  Â  Â  Â  if (distance < 15 && distance < minDistance) {
Â  Â  Â  Â  Â  Â  minDistance = distance;
Â  Â  Â  Â  Â  Â  closestPoint = point;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  
Â  Â  Â  Â  if (closestPoint) {
Â  Â  Â  Â  Â  // A unique identifier for the point (lapNumber, driver/session)
Â  Â  Â  Â  Â  const pointIdentifier = `${closestPoint.lapNumber}-${closestPoint.isComparison}-${closestPoint.sessionIndex}`; 

Â  Â  Â  Â  Â  if (!activePoint || activePoint.identifier !== pointIdentifier) {
Â  Â  Â  Â  Â  Â  activePoint = { ...closestPoint, identifier: pointIdentifier };
Â  Â  Â  Â  Â  Â  showTooltip(activePoint, e.clientX, e.clientY);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  activePoint = null;
Â  Â  Â  Â  Â  hideTooltip();
Â  Â  Â  Â  }
Â  Â  Â  };

Â  Â  Â  canvas.currentMouseLeaveHandler = () => {
Â  Â  Â  Â  activePoint = null;
Â  Â  Â  Â  hideTooltip();
Â  Â  Â  };

Â  Â  Â  canvas.addEventListener('mousemove', canvas.currentMouseMoveHandler);
Â  Â  Â  canvas.addEventListener('mouseleave', canvas.currentMouseLeaveHandler);
Â  Â  }
Â  Â  
Â  Â  function showTooltip(point, mouseX, mouseY) {
Â  Â  Â  const tooltip = document.getElementById('chart-tooltip');
Â  Â  Â  const canvas = document.getElementById('lap-chart');
Â  Â  Â  const canvasRect = canvas.getBoundingClientRect();
Â  Â  Â  
Â  Â  Â  let session = currentSessionData;
Â  Â  Â  let dataset = currentDataset;
Â  Â  Â  let fastestTime = Math.min(...dataset.map(l => parseTime(l.time)));
Â  Â  Â  let driverLabel = '';
Â  Â  Â  let lineColor = '#f44336'; // Default for main session

Â  Â  Â  if (point.isComparison && point.sessionIndex !== undefined) {
Â  Â  Â  Â  session = comparisonSessions[point.sessionIndex];
Â  Â  Â  Â  dataset = comparisonDatasets[point.sessionIndex];
Â  Â  Â  Â  fastestTime = Math.min(...dataset.map(l => parseTime(l.time)));
Â  Â  Â  Â  // Get the line color for the comparison session
Â  Â  Â  Â  lineColor = comparisonColors[point.sessionIndex % comparisonColors.length].line; 
Â  Â  Â  Â  driverLabel = `<span class="tooltip-driver" style="color: ${lineColor};">${session.driver}</span>`;
Â  Â  Â  }

Â  Â  Â  const currentTime = parseTime(point.lap.time);
Â  Â  Â  const delta = currentTime - fastestTime;
Â  Â  Â  const deltaStr = delta === 0 ? 'Fastest Lap' : (delta > 0 ? `+${delta.toFixed(3)}s` : `${delta.toFixed(3)}s`);
Â  Â  Â  
Â  Â  Â  const tooltipHTML = `
Â  Â  Â  Â  <div class="tooltip-header">
Â  Â  Â  Â  Â  ${driverLabel}
Â  Â  Â  Â  Â  <span class="tooltip-lap">Lap ${point.lapNumber}</span>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="tooltip-time">${point.lap.time}</div>
Â  Â  Â  Â  ${point.lap.best ? '<div class="tooltip-best">â˜… Best Lap</div>' : ''}
Â  Â  Â  Â  <div class="tooltip-delta">${deltaStr}</div>
Â  Â  Â  Â  <div class="tooltip-footer">
Â  Â  Â  Â  Â  Session: ${new Date(session.session_date).toLocaleDateString()}<br>
Â  Â  Â  Â  Â  Kart: ${session.kart}
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  Â  
Â  Â  Â  tooltip.innerHTML = tooltipHTML + '<div class="tooltip-arrow"></div>';
Â  Â  Â  tooltip.classList.add('tooltip-visible');
Â  Â  Â  
Â  Â  Â  const tooltipWidth = tooltip.offsetWidth;
Â  Â  Â  const tooltipHeight = tooltip.offsetHeight;
Â  Â  Â  
Â  Â  Â  const pointPageX = canvasRect.left + point.x;
Â  Â  Â  const pointPageY = canvasRect.top + point.y;
Â  Â  Â  
Â  Â  Â  let left = pointPageX - tooltipWidth / 2;
Â  Â  Â  let top = pointPageY - tooltipHeight - 20;
Â  Â  Â  
Â  Â  Â  const scrollX = window.scrollX || window.pageXOffset;
Â  Â  Â  const scrollY = window.scrollY || window.pageYOffset;
Â  Â  Â  
Â  Â  Â  if (left < scrollX + 20) {
Â  Â  Â  Â  left = scrollX + 20;
Â  Â  Â  }
Â  Â  Â  if (left + tooltipWidth > scrollX + window.innerWidth - 20) {
Â  Â  Â  Â  left = scrollX + window.innerWidth - tooltipWidth - 20;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // Adjust arrow direction based on vertical position
Â  Â  Â  const arrow = tooltip.querySelector('.tooltip-arrow');
Â  Â  Â  // Update arrow border color to match the line color
Â  Â  Â  arrow.style.borderTopColor = lineColor;
Â  Â  Â  arrow.style.borderBottomColor = lineColor;

Â  Â  Â  if (top < scrollY + 20) {
Â  Â  Â  Â  top = pointPageY + 30;
Â  Â  Â  Â  arrow.style.borderTop = 'none';
Â  Â  Â  Â  arrow.style.borderBottom = `8px solid ${lineColor}`;
Â  Â  Â  Â  arrow.style.top = '-8px';
Â  Â  Â  Â  arrow.style.bottom = 'auto';
Â  Â  Â  } else {
Â  Â  Â  Â  arrow.style.borderTop = `8px solid ${lineColor}`;
Â  Â  Â  Â  arrow.style.borderBottom = 'none';
Â  Â  Â  Â  arrow.style.bottom = '-8px';
Â  Â  Â  Â  arrow.style.top = 'auto';
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  tooltip.style.left = left + 'px';
Â  Â  Â  tooltip.style.top = top + 'px';
Â  Â  }
Â  Â  
Â  Â  function hideTooltip() {
Â  Â  Â  const tooltip = document.getElementById('chart-tooltip');
Â  Â  Â  tooltip.classList.remove('tooltip-visible');
Â  Â  }

Â  Â  function drawLineChart(mainLaps, compareLapsArray = []) {
Â  Â  Â  const canvas = document.getElementById('lap-chart');
Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  
Â  Â  Â  canvas.width = canvas.offsetWidth;
Â  Â  Â  canvas.height = canvas.offsetHeight;

Â  Â  Â  const padding = 60;
Â  Â  Â  const chartWidth = canvas.width - padding * 2;
Â  Â  Â  const chartHeight = canvas.height - padding * 2;

Â  Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  Â  chartPoints = [];
Â  Â  Â  currentDataset = mainLaps;
Â  Â  Â  comparisonDatasets = compareLapsArray; // Update the global variable

Â  Â  Â  // Collect all laps to determine the min/max time and max lap count
Â  Â  Â  const allDatasets = [mainLaps, ...compareLapsArray];
Â  Â  Â  const allLaps = allDatasets.flat();
Â  Â  Â  const lapTimes = allLaps.map(lap => parseTime(lap.time));
Â  Â  Â  
Â  Â  Â  // Handle edge case of no laps
Â  Â  Â  if (lapTimes.length === 0) {
Â  Â  Â  Â  ctx.fillStyle = '#999';
Â  Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  Â  ctx.fillText("No lap data available to chart.", canvas.width / 2, canvas.height / 2);
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  const minTime = Math.min(...lapTimes);
Â  Â  Â  const maxTime = Math.max(...lapTimes);
Â  Â  Â  const timeRange = maxTime - minTime || 1;
Â  Â  Â  const maxLapsCount = allDatasets.reduce((max, dataset) => Math.max(max, dataset.length), 0);

Â  Â  Â  // Y-axis grid lines (Time)
Â  Â  Â  ctx.strokeStyle = '#3d3d3d';
Â  Â  Â  ctx.lineWidth = 1;
Â  Â  Â  for (let i = 0; i <= 5; i++) {
Â  Â  Â  Â  const y = padding + (chartHeight / 5) * i;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.moveTo(padding, y);
Â  Â  Â  Â  ctx.lineTo(canvas.width - padding, y);
Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  }

Â  Â  Â  // X-axis grid lines (Laps)
Â  Â  Â  for (let i = 0; i < maxLapsCount; i++) {
Â  Â  Â  Â  const x = padding + (chartWidth / (maxLapsCount - 1 || 1)) * i;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.moveTo(x, padding);
Â  Â  Â  Â  ctx.lineTo(x, canvas.height - padding);
Â  Â  Â  Â  ctx.strokeStyle = '#2d2d2d';
Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  }

Â  Â  Â  // Function to draw a single lap line
Â  Â  Â  function drawLapLine(laps, color, pointColor, isComparison = false, sessionIndex = -1) {
Â  Â  Â  Â  if (laps.length === 0) return;

Â  Â  Â  Â  ctx.strokeStyle = color;
Â  Â  Â  Â  ctx.lineWidth = 3;
Â  Â  Â  Â  ctx.beginPath();

Â  Â  Â  Â  laps.forEach((lap, i) => {
Â  Â  Â  Â  Â  const x = padding + (chartWidth / (maxLapsCount - 1 || 1)) * i;
Â  Â  Â  Â  Â  const lapTime = parseTime(lap.time);
Â  Â  Â  Â  Â  const y = padding + chartHeight - ((lapTime - minTime) / timeRange) * chartHeight;

Â  Â  Â  Â  Â  if (i === 0) {
Â  Â  Â  Â  Â  Â  ctx.moveTo(x, y);
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  ctx.lineTo(x, y);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  chartPoints.push({
Â  Â  Â  Â  Â  Â  x, y,
Â  Â  Â  Â  Â  Â  lap: lap,
Â  Â  Â  Â  Â  Â  lapNumber: lap.lap,
Â  Â  Â  Â  Â  Â  isComparison: isComparison,
Â  Â  Â  Â  Â  Â  sessionIndex: sessionIndex
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  Â  Â  ctx.stroke();

Â  Â  Â  Â  laps.forEach((lap, i) => {
Â  Â  Â  Â  Â  const x = padding + (chartWidth / (maxLapsCount - 1 || 1)) * i;
Â  Â  Â  Â  Â  const lapTime = parseTime(lap.time);
Â  Â  Â  Â  Â  const y = padding + chartHeight - ((lapTime - minTime) / timeRange) * chartHeight;

Â  Â  Â  Â  Â  // Draw hover circle area
Â  Â  Â  Â  Â  ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  ctx.arc(x, y, 15, 0, Math.PI * 2);
Â  Â  Â  Â  Â  ctx.fill();
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Draw point
Â  Â  Â  Â  Â  ctx.fillStyle = pointColor;
Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  ctx.arc(x, y, 6, 0, Math.PI * 2);
Â  Â  Â  Â  Â  ctx.fill();
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  ctx.strokeStyle = '#fff';
Â  Â  Â  Â  Â  ctx.lineWidth = 1;
Â  Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  function drawBestLapMarkers(laps) {
Â  Â  Â  Â  const bestLapIndex = laps.findIndex(lap => lap.best);
Â  Â  Â  Â  if (bestLapIndex !== -1) {
Â  Â  Â  Â  Â  // Use maxLapsCount for consistent marker positioning
Â  Â  Â  Â  Â  const x = padding + (chartWidth / (maxLapsCount - 1 || 1)) * bestLapIndex;
Â  Â  Â  Â  Â  const lapTime = parseTime(laps[bestLapIndex].time);
Â  Â  Â  Â  Â  const y = padding + chartHeight - ((lapTime - minTime) / timeRange) * chartHeight;

Â  Â  Â  Â  Â  // Draw a star marker for the best lap
Â  Â  Â  Â  Â  ctx.fillStyle = '#ffd700';
Â  Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  Â  ctx.moveTo(x, y - 10);
Â  Â  Â  Â  Â  for (let i = 1; i <= 5; i++) {
Â  Â  Â  Â  Â  Â  const angle = (i * 4 * Math.PI) / 5;
Â  Â  Â  Â  Â  Â  const radius = i % 2 === 0 ? 8 : 4;
Â  Â  Â  Â  Â  Â  ctx.lineTo(x + Math.sin(angle) * radius, y - Math.cos(angle) * radius);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  ctx.closePath();
Â  Â  Â  Â  Â  ctx.fill();
Â  Â  Â  Â  Â  ctx.strokeStyle = '#fff';
Â  Â  Â  Â  Â  ctx.lineWidth = 1;
Â  Â  Â  Â  Â  ctx.stroke();
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // 1. Draw all comparison lines
Â  Â  Â  compareLapsArray.forEach((laps, index) => {
Â  Â  Â  Â  const colors = comparisonColors[index % comparisonColors.length];
Â  Â  Â  Â  drawLapLine(laps, colors.line, colors.point, true, index);
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // 2. Draw the main session line (Always Red)
Â  Â  Â  drawLapLine(mainLaps, '#f44336', '#ff5252', false, -1);
Â  Â  Â  
Â  Â  Â  // 3. Draw Best Lap Markers for all sessions
Â  Â  Â  allDatasets.forEach(laps => drawBestLapMarkers(laps));

Â  Â  Â  // X-axis labels (Laps)
Â  Â  Â  ctx.fillStyle = '#999';
Â  Â  Â  ctx.font = '12px Arial';
Â  Â  Â  ctx.textAlign = 'center';
Â  Â  Â  for (let i = 0; i < maxLapsCount; i++) {
Â  Â  Â  Â  const x = padding + (chartWidth / (maxLapsCount - 1 || 1)) * i;
Â  Â  Â  Â  // Only label every X lap to avoid clutter
Â  Â  Â  Â  if (i % Math.ceil(maxLapsCount / 10) === 0 || i === maxLapsCount - 1) {
Â  Â  Â  Â  Â  ctx.fillText(`L${i + 1}`, x, canvas.height - 20);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // Y-axis labels (Time)
Â  Â  Â  ctx.textAlign = 'right';
Â  Â  Â  ctx.textBaseline = 'middle';
Â  Â  Â  for (let i = 0; i <= 5; i++) {
Â  Â  Â  Â  const y = padding + (chartHeight / 5) * i;
Â  Â  Â  Â  const time = maxTime - (timeRange / 5) * i;
Â  Â  Â  Â  ctx.fillText(formatTime(time), padding - 10, y);
Â  Â  Â  }

Â  Â  Â  // Build Legend
Â  Â  Â  const legend = document.getElementById('chart-legend');
Â  Â  Â  let legendHTML = `
Â  Â  Â  Â  <div class="legend-item">
Â  Â  Â  Â  Â  <div class="legend-color" style="background: #f44336;"></div>
Â  Â  Â  Â  Â  <span>${currentSessionData.driver} (${mainLaps.length} laps)</span>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  Â  
Â  Â  Â  comparisonSessions.forEach((session, index) => {
Â  Â  Â  Â  const colors = comparisonColors[index % comparisonColors.length];
Â  Â  Â  Â  legendHTML += `
Â  Â  Â  Â  Â  <div class="legend-item">
Â  Â  Â  Â  Â  Â  <div class="legend-color" style="background: ${colors.line};"></div>
Â  Â  Â  Â  Â  Â  <span>${session.driver} (${comparisonDatasets[index].length} laps)</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  });

Â  Â  Â  legendHTML += `
Â  Â  Â  Â  <div class="legend-item">
Â  Â  Â  Â  Â  <div class="legend-color" style="background: #ffd700;"></div>
Â  Â  Â  Â  Â  <span>â˜… Best Lap</span>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  Â  
Â  Â  Â  legend.innerHTML = legendHTML;

Â  Â  Â  setupTooltipInteractions();
Â  Â  }

Â  Â  function renderSession(data) {
Â  Â  Â  document.getElementById('driver').textContent = data.driver;
Â  Â  Â  
Â  Â  Â  const validLaps = data.laps.filter(lap => lap.lap !== null);
Â  Â  Â  const lapTimes = validLaps.map(lap => parseTime(lap.time));
Â  Â  Â  const fastestTime = lapTimes.length > 0 ? Math.min(...lapTimes) : 0;
Â  Â  Â  const fastestLapIndex = lapTimes.indexOf(fastestTime);
Â  Â  Â  
Â  Â  Â  validLaps.forEach((lap, i) => {
Â  Â  Â  Â  lap.best = (i === fastestLapIndex);
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  document.getElementById('fastest').textContent = formatTime(fastestTime);
Â  Â  Â  
Â  Â  Â  document.getElementById('track-link').textContent = data.track.name;
Â  Â  Â  document.getElementById('track-link').href = data.track.maps_link;
Â  Â  Â  document.getElementById('kart').textContent = data.kart;
Â  Â  Â  document.getElementById('session-date').textContent = new Date(data.session_date).toLocaleDateString('en-US', { 
Â  Â  Â  Â  year: 'numeric', month: 'long', day: 'numeric' 
Â  Â  Â  });

Â  Â  Â  document.getElementById('total-laps').textContent = validLaps.length;

Â  Â  Â  const avgTime = lapTimes.length > 0 ? lapTimes.reduce((a, b) => a + b, 0) / lapTimes.length : 0;
Â  Â  Â  
Â  Â  Â  document.getElementById('average').textContent = formatTime(avgTime);

Â  Â  Â  const stdDev = calculateConsistency(lapTimes);
Â  Â  Â  const consistency = getConsistencyRating(stdDev);
Â  Â  Â  const consistencyEl = document.getElementById('consistency');
Â  Â  Â  consistencyEl.textContent = `${consistency.text} (Â±${stdDev.toFixed(3)}s)`;
Â  Â  Â  consistencyEl.className = `stat-value small ${consistency.class}`;

Â  Â  Â  drawLineChart(validLaps);

Â  Â  Â  document.getElementById('ig').href = data.socials.instagram;
Â  Â  Â  document.getElementById('fb').href = data.socials.facebook;
Â  Â  Â  document.getElementById('web').href = data.socials.website;
Â  Â  }

Â  Â  async function compareSession() {
Â  Â  Â  const compareIdsInput = document.getElementById('compare-id').value.trim();
Â  Â  Â  const sessionIds = compareIdsInput.split(',').map(id => id.trim()).filter(id => id.length > 0);
Â  Â  Â  
Â  Â  Â  // Clear previous comparison data
Â  Â  Â  comparisonSessions = [];
Â  Â  Â  comparisonDatasets = [];
Â  Â  Â  const currentLaps = currentSessionData.laps.filter(l => l.lap !== null);
Â  Â  Â  
Â  Â  Â  if (sessionIds.length === 0) {
Â  Â  Â  Â  drawLineChart(currentLaps, []);
Â  Â  Â  Â  document.getElementById('comparison-results').innerHTML = '';
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // Fetch all comparison sessions concurrently
Â  Â  Â  const fetchPromises = sessionIds.map(id => 
Â  Â  Â  Â  fetch(`sessions/${id}.json`)
Â  Â  Â  Â  Â  .then(r => r.ok ? r.json() : Promise.reject(`Session ${id} not found`))
Â  Â  Â  Â  Â  .catch(err => ({ error: err })) // Catch error and return an object with error info
Â  Â  Â  );

Â  Â  Â  const results = await Promise.all(fetchPromises);
Â  Â  Â  
Â  Â  Â  const successfulSessions = results.filter(r => !r.error);
Â  Â  Â  const errorSessions = results.filter(r => r.error);
Â  Â  Â  
Â  Â  Â  successfulSessions.forEach(sessionData => {
Â  Â  Â  Â  const compareLaps = sessionData.laps.filter(l => l.lap !== null);
Â  Â  Â  Â  const compareTimes = compareLaps.map(l => parseTime(l.time));
Â  Â  Â  Â  const compareFastest = compareTimes.length > 0 ? Math.min(...compareTimes) : 0;
Â  Â  Â  Â  const compareFastestIdx = compareTimes.indexOf(compareFastest);
Â  Â  Â  Â  
Â  Â  Â  Â  compareLaps.forEach((lap, i) => lap.best = (i === compareFastestIdx));

Â  Â  Â  Â  comparisonSessions.push(sessionData);
Â  Â  Â  Â  comparisonDatasets.push(compareLaps);
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // Recalculate main session's best lap status to ensure it's marked correctly
Â  Â  Â  const currentTimes = currentLaps.map(l => parseTime(l.time));
Â  Â  Â  const currentFastest = currentTimes.length > 0 ? Math.min(...currentTimes) : 0;
Â  Â  Â  const currentFastestIdx = currentTimes.indexOf(currentFastest);
Â  Â  Â  currentLaps.forEach((lap, i) => lap.best = (i === currentFastestIdx));
Â  Â  Â  
Â  Â  Â  // Draw the chart with all successful comparison sessions
Â  Â  Â  drawLineChart(currentLaps, comparisonDatasets);

Â  Â  Â  // Generate Comparison Results HTML
Â  Â  Â  let resultHTML = '';
Â  Â  Â  
Â  Â  Â  // 1. Current Session Card
Â  Â  Â  const currentAvg = currentTimes.length > 0 ? currentTimes.reduce((sum, t) => sum + t, 0) / currentTimes.length : 0;
Â  Â  Â  resultHTML += createComparisonCard(currentSessionData, currentFastest, currentAvg, currentLaps.length, '#f44336');

Â  Â  Â  // 2. Comparison Session Cards
Â  Â  Â  comparisonSessions.forEach((session, index) => {
Â  Â  Â  Â  const laps = comparisonDatasets[index];
Â  Â  Â  Â  const times = laps.map(l => parseTime(l.time));
Â  Â  Â  Â  const fastest = times.length > 0 ? Math.min(...times) : 0;
Â  Â  Â  Â  const avg = times.length > 0 ? times.reduce((sum, t) => sum + t, 0) / times.length : 0;
Â  Â  Â  Â  const color = comparisonColors[index % comparisonColors.length].line;
Â  Â  Â  Â  resultHTML += createComparisonCard(session, fastest, avg, laps.length, color);
Â  Â  Â  });

Â  Â  Â  // 3. Overall Best Card (if there's more than one session)
Â  Â  Â  if (comparisonSessions.length > 0) {
Â  Â  Â  Â  const allFastestTimes = [
Â  Â  Â  Â  Â  { time: currentFastest, driver: currentSessionData.driver, color: '#f44336' },
Â  Â  Â  Â  Â  ...comparisonSessions.map((s, i) => ({
Â  Â  Â  Â  Â  Â  time: Math.min(...comparisonDatasets[i].map(l => parseTime(l.time))),
Â  Â  Â  Â  Â  Â  driver: s.driver,
Â  Â  Â  Â  Â  Â  color: comparisonColors[i % comparisonColors.length].line
Â  Â  Â  Â  Â  }))
Â  Â  Â  Â  ];
Â  Â  Â  Â  
Â  Â  Â  Â  const overallBest = allFastestTimes.reduce((best, current) => current.time < best.time ? current : best, allFastestTimes[0]);
Â  Â  Â  Â  
Â  Â  Â  Â  resultHTML += `
Â  Â  Â  Â  Â  <div class="comparison-card">
Â  Â  Â  Â  Â  Â  <h3>ğŸ† Overall Fastest Lap</h3>
Â  Â  Â  Â  Â  Â  <p><strong>Time:</strong> <strong class="fastest-time" style="font-size: 1.8em; color: ${overallBest.color};">${formatTime(overallBest.time)}</strong></p>
Â  Â  Â  Â  Â  Â  <p><strong>Driver:</strong> <strong style="color: ${overallBest.color};">${overallBest.driver}</strong></p>
Â  Â  Â  Â  Â  Â  <p><strong>Session:</strong> ${overallBest.driver === currentSessionData.driver ? new Date(currentSessionData.session_date).toLocaleDateString() : new Date(comparisonSessions.find(s => s.driver === overallBest.driver)?.session_date || 'Unknown').toLocaleDateString()}</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  }

Â  Â  Â  // 4. Error Messages
Â  Â  Â  errorSessions.forEach(err => {
Â  Â  Â  Â  resultHTML += `<div class="error-message">${err.error}</div>`;
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  document.getElementById('comparison-results').innerHTML = resultHTML;
Â  Â  }

Â  Â  function createComparisonCard(data, fastest, average, lapCount, color) {
Â  Â  Â  return `
Â  Â  Â  Â  <div class="comparison-card" style="border-top-color: ${color};">
Â  Â  Â  Â  Â  <h3>${data.driver} - ${new Date(data.session_date).toLocaleDateString()}</h3>
Â  Â  Â  Â  Â  <p><strong>Fastest:</strong> <span style="font-weight: bold; color: ${color === '#f44336' ? '#ffd700' : color};">${formatTime(fastest)}</span></p>
Â  Â  Â  Â  Â  <p><strong>Average:</strong> ${formatTime(average)}</p>
Â  Â  Â  Â  Â  <p><strong>Laps:</strong> ${lapCount}</p>
Â  Â  Â  Â  Â  <p><strong>Kart:</strong> ${data.kart}</p>
Â  Â  Â  Â  </div>
Â  Â  Â  `;
Â  Â  }

Â  Â  function clearComparison() {
Â  Â  Â  comparisonSessions = [];
Â  Â  Â  comparisonDatasets = [];
Â  Â  Â  document.getElementById('compare-id').value = '';
Â  Â  Â  document.getElementById('comparison-results').innerHTML = '';
Â  Â  Â  
Â  Â  Â  if (currentSessionData) {
Â  Â  Â  Â  const validLaps = currentSessionData.laps.filter(lap => lap.lap !== null);
Â  Â  Â  Â  // Pass an empty array to drawLineChart to clear comparisons
Â  Â  Â  Â  drawLineChart(validLaps, []); 
Â  Â  Â  }
Â  Â  }
Â  </script>
</body>
</html>